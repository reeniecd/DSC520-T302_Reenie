---
title: "DSC_520_week9_Assignment00"
author: "Reenie Christudass"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

## DGN: Diagnosis - specific combination of ICD-10 codes for primary and secondary as well multiple tumours if any (DGN3,DGN2,DGN4,DGN6,DGN5,DGN8,DGN1) 
## PRE4: Forced vital capacity - FVC (numeric) 
## PRE5: Volume that has been exhaled at the end of the first second of forced expiration - FEV1 (numeric) 
## PRE6: Performance status - Zubrod scale (PRZ2,PRZ1,PRZ0) 
## PRE7: Pain before surgery (T,F) 
## PRE8: Haemoptysis before surgery (T,F) 
## PRE9: Dyspnoea before surgery (T,F) 
## PRE10: Cough before surgery (T,F) 
## PRE11: Weakness before surgery (T,F) 
## PRE14: T in clinical TNM - size of the original tumour, from OC11 (smallest) to OC14 (largest) (OC11,OC14,OC12,OC13) 
## PRE17: Type 2 DM - diabetes mellitus (T,F) 
## PRE19: MI up to 6 months (T,F) 
## PRE25: PAD - peripheral arterial diseases (T,F) 
## PRE30: Smoking (T,F) 
## PRE32: Asthma (T,F) 
## AGE: Age at surgery (numeric) 
## Risk1Y: 1 year survival period - (T)rue value if died (T,F)

## Load Libraries
```{r}
if(!require('foreign')) {
  install.packages('foreign')
  library('foreign')
}
if(!require('tidyr')) {
  install.packages('tidyr')
  library('tidyr')
}
install.packages("MASS", repos="http://cran.us.r-project.org")
library(MASS)
```

```{r}
## Set the working directory to the root of your DSC 520 directory
setwd("C:/Users/chris/dsc520/data")
```

```{r}
## Load the `data/r4ds/heights.csv` to
df <- read.arff("C:/Users/chris/dsc520/data/ThoraricSurgery.arff")
head(df)
```


```{r}
data_new <- sapply(df, unclass)           # Convert categorical variables
head(data_new)

```

```{r}
# convert the matrix into dataframe
newdata=as.data.frame(data_new)
newdata
```

```{r}
##Fit a binary logistic regression model to the data set that predicts whether or not the 
##patient survived for one year (the Risk1Y variable) after the surgery. Use the glm() function 
##to perform the logistic regression. See Generalized Linear Models for an example. 
##Include a summary using the summary() function in your results.

newdata2 <-newdata[,c("DGN","PRE4","PRE5","PRE6","PRE7","PRE8","PRE9","PRE11","PRE14","PRE17","PRE19","PRE25","PRE30"
                      ,"PRE32","AGE","Risk1Yr")]

riskmodel<-glm(as.factor(Risk1Yr)~DGN+PRE4+PRE5+PRE6+PRE7+PRE8+PRE9+PRE11+PRE14+PRE17+PRE19+PRE25+PRE30+PRE32+AGE,
                family=binomial,data=newdata2) 
summary(riskmodel) 
```



```{r}
##VARIABLE SELECTION
riskmodel_new <- stepAIC(riskmodel)
```

```{r}
##CONCLUSION:
##At the very last step stepAIC has produced the optimal set of features {DGN + PRE9 + PRE11 + PRE14 + 
##    PRE17 + PRE30}. stepAIC also removes the Multicollinearity.

```

```{r}
summary(riskmodel_new)
```

```{r}
##Analysis of the outcome

summary(newdata2$fitted.values)
hist(riskmodel_new$fitted.values,main = " Histogram ",xlab = "", col = 'light green')
newdata2$Predict <- ifelse(riskmodel_new$fitted.values >0.5,"Survived","Not Survive")
newdata2

```



```{r}
##Model Performance Evaluation
riskmodel$aic
riskmodel_new$aic
## CONCLUSION : A model with minimum AIC value is preferred.The above shows the AIC of the original model riskmodel and the model derived by stepAIC function â€” riskmodel_new.  The model derived by stepAIC function corresponds to lower AIC value.
```

```{r}
##Confusion Matrix
mytable <- table(newdata2$Risk1Yr,newdata2$Predict)
mytable
efficiency <- sum(diag(mytable))/sum(mytable)
efficiency
## CONCLUSION: The accuracy of our model is 84.7%
```

